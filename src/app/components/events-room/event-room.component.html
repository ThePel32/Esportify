<div *ngIf="!isLoading">
  <div *ngIf="!isBanned">
    <div class="event-room" *ngIf="eventData">
      <div class="event-info">
        <div class="header">
          <img *ngIf="eventData.images" [src]="eventData.images" alt="image du jeu" />
          <div class="details">
            <p><strong>Date :</strong> {{ eventData.date_time | date:'dd/MM/yyyy à HH:mm' }}</p>
            <p><strong>Organisateur :</strong> {{ eventData.organizer_name || 'Inconnu' }}</p>
            <p><strong>Durée :</strong> {{ eventData.duration }} heure(s)</p>
            <p><strong>Description :</strong> {{ eventData.description }}</p>

            <div class="participants">
              <p><strong>Participants :</strong></p>
              <ul>
                <li *ngFor="let p of eventData.participants" (click)="openParticipantMenu(p)" class="clickable-participant">
                  {{ p.username }} <span *ngIf="p.has_joined"></span>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="score-section" *ngIf="isOver()">
          <button class="scoreButton" *ngIf="canEnterScore" mat-raised-button color="accent" (click)="openScoreDialog()">
            Entrer un score
          </button>

          <div class="score-display">
            <div class="score-left">
              <h3>Ton score</h3>
              <ng-container *ngIf="userScore; else noScore">
                <p *ngIf="userScore.metadata?.kills"><strong>Kills :</strong> {{ userScore.metadata.kills }}</p>
                <p *ngIf="userScore.metadata?.score"><strong>Score :</strong> {{ userScore.metadata.score }} - {{ userScore.metadata.score_opponent }}</p>
                <p>
                  <strong>Résultat :</strong>
                  <span [ngClass]="{
                    'result-win': userScore.result === 'win',
                    'result-lose': userScore.result === 'lose'
                  }">
                    {{ userScore.result === 'win' ? 'Gagné' : 'Perdu' }}
                  </span>
                </p>
              </ng-container>
              <ng-template #noScore><p>Aucun score enregistré.</p></ng-template>
            </div>

            <div class="score-right">
              <h3>Top 10</h3>
              <ul>
                <li *ngFor="let s of topScores">
                  {{ s.username }} :
                  <span *ngIf="s.metadata?.score">{{ s.metadata.score }} - {{ s.metadata.score_opponent }}</span>
                  <span *ngIf="!s.metadata?.score">{{ s.score }}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-section">
        <h3>Chat</h3>
        <div class="chat-messages"><p>(À intégrer avec socket.io)</p></div>
        <div class="chat-input">
          <input type="text" placeholder="Écris ton message..." />
          <button>Envoyer</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="isBanned" class="banned-wrapper">
    <div class="banned-message">
      Vous avez été banni de cet événement. Retour à la liste des événements.
    </div>
  </div>
</div>
